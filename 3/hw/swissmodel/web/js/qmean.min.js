function drawQMEANLocal(a,u,v,G,d,H){var m=["lq-chart"+(u?"-"+u:"")];if((d||!(0<$("#"+m[0]+" svg").length))&&a){if(1<a.length)for(d=0;d<a.length;d++)m.push("lq-chart"+(u?"-"+u:"")+"-"+a[d].chain);$("#"+m[0]+"-thumb").empty();for(d=0;d<m.length;d++)0==$("#"+m[d]).length?$("body").append('<div rel="'+u+'" id="'+m[d]+'" style="display:none"></div>'):$("#"+m[d]).empty(),0<d&&0==$('a[href="#'+m[d]+'"]').length&&$("body").append('<a href="#'+m[d]+'" rel="lq-'+(u?u:"")+'" class="fancybox"/>'),$("#"+m[d]).empty();
u=!0;for(var e=0;e<m.length;e++){var f=0,h=0,p=0,z=!1;if(u){var k=$("#"+m[e]+"-thumb").closest(":visible").width();if(340<k){var w=12;f=45;h=30;p=40;k-=f;var l=400/620*k-p+h;z=!0}else l=.5*k,G&&(f=30,h=16),w=Math.max(15,l/10)}else w=20,f=45,h=30,p=40,k=620+f,l=400+p+h;for(var q=Raphael(m[e]+(u?"-thumb":""),k,l),B=99999,A=0,c=0;c<a.length;c++)if(!(0<e&&e-1!=c)){for(d=0;d<a[c].scores.length;d++)if(a[c].scores[d][1]){B=Math.min(a[c].scores[d][0],B);break}for(d=a[c].scores.length-1;-1<d;d--)if(a[c].scores[d][1]){A=
Math.max(a[c].scores[d][0],A);break}}var n=l-p-h,C=(k-f)/(A-B);q.rect(0,0,k,l).attr({fill:"#FFF",stroke:"#FFF"});if(u&&!z)q.rect(f,h,k-f,n).attr({stroke:"#DDD"}),G&&q.text(k/2,8,"Local Quality Estimate").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,k/24)}),q.text(k/2,l-8,"Residue Number").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,k/26)}),G&&(q.text(6,l/2+h/2,"Predicted Local").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,k/26)}).rotate(270,
6,l/2+h/2),q.text(18,l/2+h/2,"Similarity to Target").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,k/26)}).rotate(270,18,l/2+h/2));else{q.rect(f,h,k-f,n).attr({stroke:"#DDD"});z=14;q.text(k/2,10,"Local Quality Estimate"+(H?" (QMEANBrane) ":"")+(0<e?" - Chain "+a[e-1].chain:"")).attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,k/26)});u?(q.text(6,l/2,"Predicted Local").attr({"text-anchor":"middle",fill:"#666","font-size":w}).rotate(270,6,l/2),q.text(18,l/2,"Similarity to Target").attr({"text-anchor":"middle",
fill:"#666","font-size":w}).rotate(270,18,l/2),z=w):q.text(10,l/2,"Predicted Local Similarity to Target").attr({dy:10,"text-anchor":"middle",fill:"#666","font-size":w}).rotate(270,10,l/2);q.text(f+(k-f)/2,l-8,"Residue Number").attr({"text-anchor":"middle",fill:"#666","font-size":w});for(c=0;1>=c;c+=.2)q.path("M"+f+" "+(n*c+h)+"L"+(f-5)+" "+(n*c+h)).attr({stroke:"#CCC","stroke-width":1}),q.text(f-12,n*c+h,(1-c).toFixed(1)).attr({fill:"#444","font-size":z});w=Math.floor((A-B)/8);w-=w%10;w=Math.max(10,
w);for(c=B;c<A;c++)0==c%w&&(d=f+(c-B)/(A-B)*(k-f),q.text(d,l-p+12,c).attr({fill:"#444","font-size":z}))}k="#e41a1c #377eb8 #4daf4a #984ea3 #ff7f00 #ffff33 #a65628 #f781bf".split(" ");for(c=l=0;c<a.length;c++){u&&v&&$(".alignTbl").each(function(){if(null!=$(this).data("templateData")){var g="chain";"target-template"!=$(this).data().templateData.type&&(g="keyseqchain");var x=$.cookie("colourScheme")&&"qmean_local"==$.cookie("colourScheme");$(this).find('tr[struc_id="'+v+'"]['+g+'="'+a[c].chain+'"] span').each(function(y,
t){for(var D=parseInt(t.getAttribute("s")),F=0;F<a[c].scores.length;F++)if(D==a[c].scores[F][0]){var E=a[c].scores[F][1];if(null!=E){t.setAttribute("q",a[c].scores[F][1]);x&&(.5>E?t.style.backgroundColor="rgba(255,80,0,.6)":(E=(E-.5)/.4,r=Math.round(255*(1-E)),b=Math.round(255*E),t.style.backgroundColor="rgba("+r+",90,"+b+",.6)"));break}}})}});p="";A=!1;if(0==e||e-1==c){p="";for(d=0;d<a[c].scores.length-1;d++)if(w=a[c].scores[d][0],(z=a[c].scores[d][1])&&a[c].scores[d+1][1]){if(""==p||A)p+="M"+(f+
C*(w-B))+" "+(n*(1-z)+h),A=!1;p+="L"+(f+(C*(w-B)+C))+" "+(n*(1-a[c].scores[d+1][1])+h)}else A=!0;p=q.path(p);p.attr({stroke:k[l],"stroke-width":u?1.5:2.5})}l=++l%8}u&&(u=!1,e--)}}}
function drawQMEANGlobal(a,u,v,G,d){var H=$("#qn-chart"+(v?"-"+v:"")+"-thumb,#qn-chart"+(v?"-"+v:""));if(a&&(v="qmeanGlobalTbl"+(v?v:""),d||!(0<$("#"+v+" tr").length))){H.empty();$("#"+v+" tr").remove();a.QMEAN4&&(a.qmean4_norm_score=a.qmean4_norm,delete a.qmean4_norm,a.qmean4_z_score=a.QMEAN4,delete a.QMEAN4,a.cbeta_z_score=a.cbeta,delete a.cbeta,a.interaction_z_score=a.all_atom,delete a.all_atom,a.packing_z_score=a.solvation,delete a.solvation,a.torsion_z_score=a.torsion,delete a.torsion);a.qmean4&&
(a.qmean4_norm_score=parseFloat(a.qmean4.norm),a.qmean4_z_score=parseFloat(a.qmean4.zscore),delete a.qmean4,a.cbeta_z_score=parseFloat(a.cbeta.zscore),delete a.cbeta,a.interaction_z_score=parseFloat(a.all_atom.zscore),delete a.all_atom,a.packing_z_score=parseFloat(a.solvation.zscore),delete a.solvation,a.torsion_z_score=parseFloat(a.torsion.zscore),delete a.torsion,delete a.acc_agreement,delete a.ss_agreement,delete a.qmean6);d=[["qmean4_z_score","QMEAN"],["cbeta_z_score","C\u03b2"],["interaction_z_score",
"All Atom"],["packing_z_score","solvation"],["torsion_z_score","torsion"]];for(var m="",e=0;e<d.length;e++)null!=a[d[e][0]]&&(m+='<tr><td width="1">'+d[e][1]+'</td><td width="100%" style="padding:0px 2px 0px 2px;"><div id="'+v+"_"+d[e][0]+'">&nbsp;</div></td><td width="1" nowrap="nowrap" style="text-align:right">'+a[d[e][0]].toFixed(2)+"</td></tr>");$("#"+v).append(m);m=$("#"+v+"_"+d[0][0]).innerWidth();var f=$("#"+v+"_"+d[0][0]).parent().innerHeight();if(1>m||1>f)m=290,f=20;for(e=0;e<d.length;e++)$("#"+
v+"_"+d[e][0]).html("");for(var h=m/8,p=0;p<d.length;p++)if(null!=a[d[p][0]]){var z=Raphael(v+"_"+d[p][0],m,f);z.rect(0,0,m,f).attr({fill:"0-rgb(245,61,61)-#fff:75-rgb(77,77,255)"});var k=f/4;for(e=1;8>e;e++)z.path("M"+h*e+" 0L"+h*e+" "+k).attr({stroke:"#555"}),z.path("M"+h*e+" "+(f-k)+"L"+h*e+" "+f).attr({stroke:"#555"});a&&(e=a[d[p][0]],e=Math.min(e,1.95),e=Math.max(e,-5.95),z.path("M"+(h*e+6*h)+" 0L"+(h*e+6*h)+" "+f).attr({stroke:"#222","stroke-width":3}))}var w=a.qmean4_norm_score,l=Math.min(600,
u),q=!0;H.each(function(B,A){var c=0,n=0,C=0;if(q){var g=$(this).closest("div:visible").width();if(340<g){var x=12;c=45;n=30;C=40;g-=c;var y=400/620*g-C+n}else y=.5*g,G&&(c=15,n=30),x=Math.max(15,y/10)}else x=20,c=45,n=30,C=40,g=617+c,y=398+C+n;var t=Raphael($(this).attr("id"),g,y),D=y-C-n,F=l/600*(g-c)+c,E=D-w/1.5*D+n;t.rect(0,0,g,y).attr({fill:"#FFF",stroke:"#FFF"});"undefined"===typeof localQMEANNormImage?t.image("/static/images/qmean_norm.png",c,n,g-c,D):t.image(localQMEANNormImage,c,n,g-c,D);
t.rect(c,n,g-c,D).attr({stroke:"#DDD"});t.text(F,E,String.fromCharCode(9733)).attr({"text-anchor":"middle",fill:"#F44","font-size":x});if(q)G&&(t.text((g+c)/2,8,"Comparison with Non-redundant").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,g/32)}),t.text((g+c)/2,22,"Set of PDB Structures").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,g/32)}),t.text(6,y/2+n/2,"Normalized QMEAN4").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,g/32)}).rotate(270,
6,y/2+n/2)),t.rect(c+1,y-Math.max(16,g/16),g-c-2,Math.max(16,g/16)).attr({fill:"#FFF","stroke-width":0}),t.text(g/2,y-8,"Protein Size (Residues)").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,g/32)});else{t.text((g+c)/2,10,"Comparison with Non-redundant Set of PDB Structures").attr({"text-anchor":"middle",fill:"#444","font-size":x});t.text(10,y/2,"Normalized QMEAN4 Score").attr({"text-anchor":"middle",fill:"#666","font-size":x}).rotate(270,10,y/2);t.text(c+(g-c)/2,y-12,"Protein Size (Residues)").attr({"text-anchor":"middle",
fill:"#666","font-size":x});for(x=100;600>x;x+=100)t.text(c+x*(g-c)/600,y-C+8,x).attr({fill:"#444","font-size":14});for(x=1.5;0<=x;x-=.5)t.text(c-12,x/1.5*D+n,(1.5-x).toFixed(1)).attr({fill:"#444","font-size":14})}q=!1})}};