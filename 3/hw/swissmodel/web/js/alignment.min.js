(function(g){function G(c){return g("#alignNameTbl"+c.attr("id").substring(8))}function Q(c){g(document).mouseup(function(){if(g.data(c,"downchain")){var e=g("#offscreen_selection span");if(window.getSelection&&0<e.length){var d=window.getSelection(),f=document.createRange();f.setStart(e.get(0),0);f.setEndAfter(e.get(-1),0);d.addRange(f)}else document.selection&&(document.body.createTextRange(),document.selection.empty());g.data(c,"downchain",null)}c.data("mouseDragEdit",null)});g(document).mousemove(function(){g.data(c,
"downchain")&&(window.getSelection?(windowSelection=window.getSelection(),windowSelection.removeAllRanges()):document.selection&&document.selection.empty())});c.off();if(null==c.data("options")||"textOnly"in c.data("options")&&!c.data("options").textOnly)var a=null;if(c.data("templateData")&&c.data("templateData").charts)c.on("mouseover mousedown mouseup mousemove dblclick","td",function(e){var d=g(this).find("span");if(0!=d.length){var f=d[0].getBoundingClientRect().width,k=g(this);if(e.pageX||e.pageY)var l=
e.pageX-k.offset().left;else if(e.clientX||e.clientY)l=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-k.offset().left;$span=g(d[Math.floor(l/f)]);a!=$span.text()?(a=$span.text(),aa(c,$span,"mouseover",e)):(a=$span.text(),aa(c,$span,e.type,e))}});c.on("mouseover mousedown mouseup mousemove dblclick","span",function(e){aa(c,g(this),e.type,e)})}function aa(c,a,e,d){var f=a.text();ha&&Ua(a,d);if(f!=da.gapChar){var k=a.attr("s");if(k){var l=a.closest("tr");d=l.attr("chain");var m=
null;d||(d=l.attr("keyseqtype"),m=l.attr("keyseqchain"));var n=l.attr("struc_id");!n&&l.attr("tpl_id")&&(n=l.attr("tpl_id"));l=c.data("templateData");"mouseover"==e&&(a.attr("title")||null==R[f.toUpperCase()]||a.attr("title",R[f.toUpperCase()].triplet+" "+k+" "+(m?m:d)+(a.attr("q")?"; QMEAN: "+parseFloat(a.attr("q")).toFixed(2):"")+(a.attr("c")?"; Consistency: "+parseFloat(a.attr("c")).toFixed(2):"")),c.attr("title",a.attr("title")),"seqres-chain"==d||"target-template"==d||"model-template"==l.type&&
null==m||g("body").trigger("highlightResidue",{src:"alignment",struc_id:n,chain:m?m:d,resno:parseInt(k)}));if(!ha&&l)if(f=!("target-template"==l.type&&"target-template"==d),"mousedown"==e)g.data(c,"downspan",a),g.data(c,"downchain",d+m+n),g(".hoverResidue").removeClass("hoverResidue"),g(".selectResidue").removeClass("selectResidue");else if("mousemove"==e||"mouseup"==e)if(g.data(c,"downchain")&&(window.getSelection?(l=window.getSelection(),l.removeAllRanges(),w=document.createRange()):document.selection&&
document.selection.empty()),"seqres-chain"==d||g.data(c,"downchain")!=d+m+n)g.data(c,"downchain");else if("mousemove"!=e||null==g.data(c,"lastMouseDrag")||g.data(c,"lastMouseDrag")!=d+m+n+a.index()){g.data(c,"lastMouseDrag",d+m+n+a.index());l=c.find("tr["+(m?'keyseqchain="'+m+'"':n?'struc_id="'+n+'"':'chain="'+d+'"')+"]");var t=g.data(c,"downspan"),q=a,r=l.index(t.closest("tr")),v=l.index(q.closest("tr"));if("mouseup"==e&&t.index()==q.index()&&r==v)a.addClass("selectResidue"),f&&g("body").trigger("centerResRange",
{src:"alignment",struc_id:n,chain:m?m:d,min:k,max:k});else{if(r>v||r==v&&t.index()>q.index())k=r,q=t,t=a,r=v,v=k;if(t.index()!=q.index()||r!=v)g(".selectResidue").removeClass("selectResidue"),t.addClass("selectResidue"),q.addClass("selectResidue"),l.each(function(u){u<r||u>v||(u==r?t.nextUntil(q).addClass("selectResidue"):u==v?q.prevUntil(q).addClass("selectResidue"):g(this).find("span").addClass("selectResidue"))});f&&"mouseup"==e&&g("body").trigger("centerResRange",{src:"alignment",struc_id:n,chain:m?
m:d,min:parseInt(t.attr("s")),max:parseInt(q.attr("s"))})}c=c.find(".selectResidue");if(0<c.length)if(g("#offscreen_selection").html(""),c.clone().appendTo(g("#offscreen_selection")),window.getSelection){l=window.getSelection();var w=document.createRange();w.setStart(g("#offscreen_selection span").get(0),0);w.setEndAfter(g("#offscreen_selection span").get(-1),0);l.addRange(w)}else document.selection&&(document.body.createTextRange(),document.selection.empty())}}}}function Ua(c,a){a.stopPropagation();
a.preventDefault();if(!ra){var e=c.closest(".alignTbl"),d=c.closest("tr"),f=c.closest("tr").attr("seqno"),k=d.attr("chain");k||(k=d.attr("keyseqtype"),d.attr("keyseqchain"));e.data("templateData");if("mouseover"!=a.type)if("dblclick"==a.type)c.hasClass("shadowCursor")&&(e.data("mouseDragEdit")||("-"==c.text()?Ca():Da()));else if("mousedown"==a.type){if(!c.hasClass("shadowCursor")){var l=g(".shadowCursor").first();if(a.shiftKey&&l)if(l.closest("tr").attr("seqno")==f){g(".shadowCursor").removeClass("shadowCursor");
d=e.find("tr[seqno="+f+"]").find("span");k=d.index(l);f=d.index(c);if(k<f)e.data("startEditRegion",l),e.data("endEditRegion",c);else{var m=k;k=f;f=m;e.data("startEditRegion",c);e.data("endEditRegion",l)}d.slice(k,f).each(function(){g(this).addClass("shadowCursor")});e.data("mouseDragEdit",!1)}else return;else g(".shadowCursor").removeClass("shadowCursor"),c.addClass("shadowCursor"),e.data("mouseDragEdit",!0),e.data("startEditRegion",c),e.data("endEditRegion",c)}g(".cursor").removeClass("cursor");
c.addClass("cursor")}else"mousemove"==a.type?((l=window.getSelection?window.getSelection():document.selection)&&(l.removeAllRanges?l.removeAllRanges():l.empty&&l.empty()),e.data("mouseDragEdit")&&(d=e.data("startEditRegion"),0!=d.length&&(e=0,e=a.pageX>d.offset().left?(a.pageX-d.offset().left)/d.outerWidth()|0:(a.pageX-d.offset().left-d.outerWidth())/d.outerWidth()|0,g(".shadowCursor").removeClass("shadowCursor"),0<e?d.nextAll(":lt("+e+")").addClass("shadowCursor"):0>e&&d.prevAll().slice(0,Math.abs(e)).each(function(){g(this).addClass("shadowCursor")}),
d.addClass("shadowCursor")))):"mouseup"==a.type&&(d=e.data("startEditRegion"))&&(d=e.find("tr[seqno="+f+"]").find("span"),k=d.index(l),N={seqno:f,seqidx:d.index(c)},e.data("startEditRegion",g("span.shadowCursor").first()),e.data("endEditRegion",g("span.shadowCursor").last()),e.data("mouseDragEdit",!1))}}function Ea(c,a){if(null==a||1>a.length)return!1;var e=g("body").data("editHistory");null==e&&(e=[]);e.push(a);g("body").data("editHistory",e);e=g(".alignTbl").not(c);0<e.length&&(wa(e,a,!1),g(".cursor").removeClass("cursor"));
return!0}function wa(c,a,e,d){c.each(function(){if(null!=g(this).data("templateData")){for(var f=g(this).data("templateData").templates,k=0;k<a.length;k++)for(var l=a[k],m=0;m<l.length;m++)for(var n=0;n<f.length;n++)if(f[n].id==l[m].template.id){e?(f[n].trg_seq=l[m].trg_seq,f[n].tpl_seq=l[m].tpl_seq):(f[n].trg_seq=l[m].template.trg_seq,f[n].tpl_seq=l[m].template.tpl_seq);d&&(N=l[m].currentCursor,k==a.length-1&&sa(f[n]));break}g(this).is(":visible")&&ba(g(this),null,{firstDraw:!1})}})}function sa(c){if(!(1>
g("#seqid_"+c.id).length)){for(var a=0,e=0,d=0;d<c.trg_seq.length;d++)"-"==c.trg_seq.charAt(d)||"-"==c.tpl_seq.charAt(d)?a++:c.trg_seq.charAt(d)==c.tpl_seq.charAt(d)&&e++;g("#seqid_"+c.id).text((e/(c.trg_seq.length-a)*100).toFixed(2))}}function xa(c,a){null==c&&(38==a.keyCode?c="up":40==a.keyCode?c="down":37==a.keyCode?c="left":39==a.keyCode&&(c="right"));if(null!=c){a&&a.preventDefault();var e=g("span.cursor").first(),d=e.closest("tr");d.closest(".alignTbl");var f=d.attr("seqno"),k=e.index(),l=k,
m=d.prevAll("[seqno="+f+"]");if(0<m.length){var n=m.find("span");l+=n.length}var t=f;if("up"==c&&0<d.index()){var q=d.prev();t=q.attr("seqno");q=q.find("span:eq("+k+")")}else"down"==c&&0<d.next().length?(q=d.next(),t=q.attr("seqno"),q.find("span:eq(rowidx)"),q=d.next().find("span"),q=q.length>k?q.eq(k):q.last()):"left"==c?0==e.prev().length?0<m.length&&(q=n.last(),l--):(q=e.prev(),l--):"right"==c&&(0<e.next().length?(q=e.next(),l++):(d=d.nextAll("[seqno="+f+"]:eq(0)"),0<d.length&&(q=d.find("span").first(),
l++)));null!=q&&(e.removeClass("cursor"),q.addClass("cursor"),N={seqno:t,seqidx:l})}}function Da(){var c=[],a=g("span.cursor").first(),e=a.closest("tr"),d=e.attr("seqno"),f=e.closest(".alignTbl");if(!a.hasClass("shadowCursor"))if(0==f.find("span.shadowCursor").length)a.addClass("shadowCursor");else return c;if(null==f.data("templateData"))return c;var k=f.find("span.shadowCursor").last(),l=k.index(),m=k[0]==a[0],n=f.find("tr"),t=k.closest("tr"),q=g(),r=0;n.filter("[seqno="+d+"]").each(function(){r++;
var O=g(this).find("span");if(g(this)[0]==t[0])return q=q.add(O.slice(0,l+1)),!1;q=q.add(O)});k=q.index(a);var v=q.text(),w=f.data("templateData").templates;e=null!=e.attr("keyseqchain");for(var u,A,D=e?null:n.filter("[seqno=1]").slice(0,r),B=a.nextAll(".shadowCursor").addBack(),C=0;C<w.length;C++)if(!(null==w[C].selected||1>w[C].selected)){if(e)u=w[C].trg_seq,A=w[C].tpl_seq,D=n.filter("[seqno="+(w[C].selected+1)+"]").slice(0,r);else if(w[C].selected==d-1)u=w[C].tpl_seq,A=w[C].trg_seq;else continue;
D.find("span").slice(0,v.length).text();for(var F="",K=!1,M=!1,I=0;I<v.length;I++)if(I<k)F+=u.charAt(F.length);else if(K)if("-"==v.charAt(I)){F+=u.charAt(F.length-1);M=!0;break}else F+=u.charAt(F.length-1);else F+="-",K=!0;M?u=F+u.substring(F.length):K&&(u=F+u.substring(F.length-1),m||(A=A.substring(0,F.length-1)+"-"+A.substring(F.length-1)));u.length>A.length?A+=Array(u.length-A.length+1).join("-"):A.length>u.length&&(u+=Array(A.length-u.length+1).join("-"));F={template:w[C],trg_seq:w[C].trg_seq,
tpl_seq:w[C].tpl_seq,currentCursor:{seqno:N.seqno,seqidx:N.seqidx}};e?(w[C].trg_seq=u,w[C].tpl_seq=A):(w[C].trg_seq=A,w[C].tpl_seq=u);sa(w[C]);c[c.length]=F}1==B.length&&g(".shadowCursor").removeClass("shadowCursor");0<c.length?(xa("right"),f.data("templateData"),m&&(f.data("startEditRegion",null),f.data("endEditRegion",null)),Ea(f,[c])&&ba(f,null,{firstDraw:!1})):Fa(a,'<strong style="color:red">The pairwise alignment already contains a gap at this position</strong>')}function Fa(c,a){ra=!0;c.removeAttr("title").popover({html:!0,
content:a,placement:"top"}).popover("show");setTimeout(function(){c.popover("destroy");ra=!1},2E3)}function Ca(c){var a=[],e=g("span.cursor").first(),d=e.closest("tr"),f=d.attr("seqno"),k=d.closest(".alignTbl"),l=2>k.find("span.shadowCursor").length;if(c){if("-"!=e.prev().text())return;l&&e.removeClass("shadowCursor");e=e.prev();e.addClass("shadowCursor")}else if("-"!=e.text())return;if(null==k.data("templateData"))return a;if(!e.hasClass("shadowCursor"))if(0==k.find("span.shadowCursor").length)e.addClass("shadowCursor");
else return a;var m=k.find("span.shadowCursor").last(),n=m.index(),t=k.find("tr"),q=m.closest("tr"),r=g(),v=0;t.filter("[seqno="+f+"]").each(function(){v++;var O=g(this).find("span");if(g(this)[0]==q[0])return r=r.add(O.slice(0,n+1)),!1;r=r.add(O)});m=r.index(e);var w=r.text(),u=k.data("templateData").templates;d=null!=d.attr("keyseqchain");var A="",D=d?null:t.filter("[seqno=1]").slice(0,v);e.nextAll(".shadowCursor").addBack();for(var B=0;B<u.length;B++)if(!(null==u[B].selected||1>u[B].selected)){if(d){var C=
u[B].trg_seq;var F=u[B].tpl_seq;D=t.filter("[seqno="+(u[B].selected+1)+"]").slice(0,v)}else if(u[B].selected==f-1)C=u[B].tpl_seq,F=u[B].trg_seq;else continue;A=D.find("span").slice(0,w.length).text();for(var K="",M=!1,I=0;I<w.length;I++)if(I!=m)if(I<m)K+=C.charAt(K.length);else if("-"==w.charAt(I)){if("-"!=A.charAt(I)){if(M)break;K+="-"}}else M=!0,K+=C.charAt(K.length+1);C=l?K+C.substring(K.length+1):K+"-"+C.substring(K.length+1);C.length>F.length?F+=Array(C.length-F.length+1).join("-"):F.length>
C.length&&(C+=Array(F.length-C.length+1).join("-"));A={template:u[B],trg_seq:u[B].trg_seq,tpl_seq:u[B].tpl_seq,currentCursor:{seqno:N.seqno,seqidx:N.seqidx}};d?(u[B].trg_seq=C,u[B].tpl_seq=F):(u[B].trg_seq=F,u[B].tpl_seq=C);sa(u[B]);a[a.length]=A}0<a.length?(c&&xa("left"),l&&(k.data("startEditRegion",null),k.data("endEditRegion",null)),Ea(k,[a])&&ba(k,null,{firstDraw:!1})):Fa(e,'<strong style="color:red">No valid gaps to be deleted in the selected range</strong>')}function Va(c,a){var e=0,d=[],f=
[],k=[],l="";g.each(c.templates,function(v,w){w&&(!a||w.selected)&&w.trg_seq&&(f[f.length]=w,d[d.length]="",k[k.length]=0,e=Math.max(w.trg_seq.length,e))});f.sort(function(v,w){return v.selected<w.selected?-1:v.selected>w.selected?1:0});if(0!=f.length){var m=null;c.keyseq_sequence?m=c.keyseq_sequence:(m=f[0].trg_seq,c.templates[0].up_res_num||(m=m.replace(/-/g,"")));for(var n=0;n<e;){for(var t=0,q=0,r=0;r<f.length;r++){for(q=0;f[r].trg_seq.charAt(k[r]+q)==da.gapChar;)q++;t=Math.max(q,t)}for(q=0;q<
t;)l+=da.gapChar,q++;l+=m.charAt(n++);for(r=0;r<f.length;r++)if(f[r].tpl_seq){for(q=0;f[r].trg_seq.charAt(k[r])==da.gapChar;)d[r]+=f[r].tpl_seq.charAt(k[r]++),q++;for(;q<t;)d[r]+=da.gapChar,q++;d[r]+=f[r].tpl_seq.charAt(k[r]++)}}d.target=l;d.templates=f;sa(f[0]);return d}}function Ga(c,a){var e;c.templates&&(e=Va(c,!0));if(!e)if(e=[],e.templates=["empty"],c.keyseq_sequence)e.target=c.keyseq_sequence;else{for(var d=0;d<c.templates.length;d++)if(c.templates[d].trg_seq){e.target=c.templates[d].trg_seq.replace(/-/g,
"");break}d=c.templates[d].trg_seq.length-e.target.length;1==c.templates.length&&0<d&&g("#alignmentWarning_"+a.attr("id").substring(8)).html('<div class="alert alert-warning"><button type="button" class="close" data-dismiss="alert">&times;</button><strong>Note: </strong> '+d+" gaps were removed from your target sequence</div>")}return e}function ba(c,a,e){$alignNameTbl=G(c);c.removeData("clustalColours");var d=c.data().templateData;d||(d=g("#alignTbl").data().templateData);if(d){a||(a=Ga(d,c));for(var f=
0,k=0;k<a.length;k++){var l=a[k].match(/[a-zA-Z]/g);l&&(f+=l.length)}f={cols:60,fastDraw:!1,textOnly:15E3<f,showResiduePosition:!0};c.data("options")?e=g.extend(c.data("options"),e):(e||(e={}),!e.cols&&c.attr("cols_cookie")&&g.cookie(c.attr("cols_cookie"))&&(e.cols=g.cookie(c.attr("cols_cookie"))),e=g.extend(f,e));0==e.cols&&(e.cols=50);e.cols=parseInt(e.cols);l=c.attr("id").substring(8);f=e.fastDraw;if(e.textOnly)g("#alignTbl"+l+"_features").remove(),c.off();else if(f){g("#alignTbl"+l+"_features").html("");
var m=Ha["timer"+l];m&&clearTimeout(m);e.fastDraw=!1;m=setTimeout(function(){ba(c,a)},10);Ha["timer"+l]=m}c.data("options",e);for(l=document.getElementById(c.attr("id"));l.hasChildNodes();)l.removeChild(l.lastChild);for(l=document.getElementById($alignNameTbl.attr("id"));l&&l.hasChildNodes();)l.removeChild(l.lastChild);var n=d.target_name?d.target_name:"model-template"==d.type?d.struc_id:d.type.split("-")[0];n=n.charAt(0).toUpperCase()+n.substring(1);var t="SEQRES"==n.toUpperCase();var q=void 0!==
d.templates?d.templates[0].modelAtomSeqs?d.templates[0].modelAtomSeqs[0].seq.length:a.target.length:a.target.length;m=l="";if(d.nowrap){l='<tr><td style="padding-top:0px;">';m='<tr><td style="padding-top:0px;border-right:none">&nbsp;</td></tr>';for(var r=a.templates[0].trg_offset;r<q+a.templates[0].trg_offset;r++)0<r&&(0<r&&0==r%10?(l+='<span style="position:relative;color:#A2A2A2;">&nbsp;',l+='<span style="position:absolute;left:0px;top:8px;font-size:.7em;">|</span>',l+='<span style="position:absolute;left:0px;top:0px;font-size:.8em;">'+
r+"</span>",l+="</span>"):l+="<span>&nbsp;</span>")}l+="</td></tr>";for(r=0;r<q;r+=e.cols){var v=1;for(k=0;k<d.keyseq_chain_name.length;k++){var w=void 0!==d.templates?d.templates[0].modelAtomSeqs?d.templates[0].modelAtomSeqs[k].seq:a.target:a.target;var u=d.keyseq_chain_name[k];m+='<tr seqno="'+v+'" '+Ia(d.keyseq_description)+"><td"+(0<r&&0==k||d.charts?' style="position:relative; padding-top:'+(ea+W+10)+'px"':"")+">"+(0<ea?'<div style="position:absolute; right:4px; top:'+(ea+W)/2+'px ">QMEAN</div>':
"")+n+(1<d.keyseq_chain_name.length?":"+u:"")+"</td></tr>";var A=a.templates[0].trg_offset?a.templates[0].trg_offset:1;void 0!==d.templates&&d.templates[0].modelAtomSeqs&&(A=d.templates[0].modelAtomSeqs[k].trg_offset);l+='<tr seqno="'+v+'" keyseqtype="'+d.type+'"'+(d.struc_id?' struc_id="'+d.struc_id+'"':"")+' keyseqchain="'+u+'"><td'+(0<r&&0==k||d.charts?' style="padding-top:'+(ea+W+10)+'px"':"")+">"+(e.fastDraw?Ja(w.substring(r,r+e.cols)):e.textOnly?"<span>"+w.substring(r,r+e.cols)+"</span>":ya(w.substring(r,
r+e.cols),{alIndex:r,pos:za(w.substring(0,r)),offset:A,annotation:d.keyseq_annotation?d.keyseq_annotation[u]:null,seqres:t,up_res_num:d.templates&&d.templates[k]&&d.templates[k].up_res_num?d.templates[k].up_res_num:null}))+"</td></tr>";v+=1}for(k=0;k<a.length;k++)w=d.templates[0].modelAtomSeqs?d.templates[0].modelAtomSeqs[k].seq:a.target,a.templates[k].tpl_seq&&(m+='<tr seqno="'+v+'" '+(null!=a.templates[k].id?'tpl_id="'+a.templates[k].id+'"':"")+' chain="'+a.templates[k].chain+'"'+Ia(a.templates[k].description)+
'><td nowrap align="left" >'+a.templates[k].qname+"</td></tr>"),u=a.templates[k].offset?a.templates[k].offset+1:1,a.templates[k].tpl_seq&&(l+='<tr seqno="'+v+'" '+(null!=a.templates[k].id?'tpl_id="'+a.templates[k].id+'"':"")+("model-template"!=d.type&&a.templates[k].struc_id?' struc_id="'+a.templates[k].struc_id+'"':"")+' qname="'+a.templates[k].qname+'" chain="'+a.templates[k].chain+'"><td nowrap align="left" >'+(e.fastDraw?Ja(a[k].substring(r,r+e.cols)):e.textOnly?"<span>"+a[k].substring(r,r+e.cols)+
"</span>":d.templates[k].pdb_res_num?ya(a[k].substring(r,r+e.cols),{alIndex:r,pos:za(a[k].substring(0,r)),offset:u,seqres:t,annotation:a.templates[k].annotation,targetSeq:w.substring(r,r+e.cols),pdb_res_num:d.templates[k].pdb_res_num.slice(r,r+e.cols)}):ya(a[k].substring(r,r+e.cols),{alIndex:r,pos:za(a[k].substring(0,r)),offset:u,seqres:t,annotation:a.templates[k].annotation,targetSeq:w.substring(r,r+e.cols)}))+"</td></tr>"),v+=1}(n=g.cookie("secStruct"))&&"none"==n||c.addClass("ss");$alignNameTbl.last().append(m);
c.last().append(l);var D;!d.nowrap&&e.showResiduePosition&&c.find("tr").each(function(B,C){D=0<B&&1==C.getAttribute("seqno")?"padding-top:"+(ea+W+10)+"px;":"";var F=g(this).find("span[s]").last().attr("s");F&&g(this).append('<td style="padding-left:8px; font-size:.8em; text-align:right; '+D+'">'+F+"</td>")});f||(e.default_colour?(g("#"+e.default_colour+"Button").prop("checked",!0),oa(e.default_colour,c)):oa(g.cookie("colourScheme"),c),a=null,e.firstDraw||ia(c))}}function za(c){return(c=c.match(/[^-]/g))?
c.length:0}function Ia(c){return c?' title="'+c+'" ':""}function Ja(c){for(var a="",e=0;e<c.length;e++)a+="<span>"+c.charAt(e)+"</span>";return a}function ya(c,a){var e=a.pos,d=a.alIndex,f=a.seqres,k=null!=a.targetSeq,l="",m=null;if(c)for(var n=0;n<c.length;n++)if(res=c.charAt(n),res==da.gapChar)l+='<span nm="true">-</span>';else if(a.pdb_res_num){var t=a.pdb_res_num[n-1],q=a.pdb_res_num[n],r=a.pdb_res_num[n+1];t&&t!=q-1&&t!=q?(0<n&&"-"==c.charAt(n-1)&&(l=l.substring(0,l.length-9)+' class="insert_r">-</span>'),
l+="<span "+ja(res.toUpperCase(),a.pdb_res_num[n],a.offset,a.annotation?a.annotation:null)+(k&&a.targetSeq.charAt(n)!=res?' nm="true"':"")+' class="insert_l">'+res+"</span>"):r&&q!=r-1&&r!=q?(l+="<span "+ja(res.toUpperCase(),a.pdb_res_num[n],a.offset,a.annotation?a.annotation:null)+(k&&a.targetSeq.charAt(n)!=res?' nm="true"':"")+' class="insert_r">'+res+"</span>",n<c.length-2&&"-"==c.charAt(n+1)&&(l+='<span nm="true" class="insert_l">-</span>',n++)):l+="<span "+ja(res.toUpperCase(),a.pdb_res_num[n],
a.offset,a.annotation?a.annotation:null)+(k&&a.targetSeq.charAt(n)!=res?' nm="true"':"")+">"+res+"</span>"}else a.up_res_num?(t=a.up_res_num[d+n-1],q=a.up_res_num[d+n],r=a.up_res_num[d+n+1],null==q&&(q=m+=1),null==r&&(t=q-1,r=q+1),l+="<span "+(0<d+n&&t!=q-1?'class="insert_l"':"")+(d+n<d+c.length-1&&q!=r-1?'class="insert_r"':"")+ja(res.toUpperCase(),q,a.offset,a.annotation?a.annotation:null,d+n)+(k&&a.targetSeq.charAt(n)!=res?' nm="true"':"")+">"+res+"</span>",m=q):f?l+="<span "+ja(res.toUpperCase(),
d+n+a.offset,a.offset,a.annotation?a.annotation:null)+(k&&a.targetSeq.charAt(n)!=res?' nm="true"':"")+">"+res+"</span>":(l+="<span "+ja(res.toUpperCase(),e+a.offset,a.offset,a.annotation?a.annotation:null)+(k&&a.targetSeq.charAt(n)!=res?' nm="true"':"")+">"+res+"</span>",e++);return l}function ja(c,a,e,d,f){c='s="'+a+'" r="'+c+'"';d&&(d.qmean&&null!=d.qmean[f?f:a-e]&&(c+=' q="'+d.qmean[f?f:a-e]+'"'),d.consistency&&null!=d.consistency[f?f:a-e]&&(c+=' c="'+d.consistency[f?f:a-e]+'"'));return c}function ka(c,
a,e){c[e][a]?c[e][a]++:c[e][a]=1}function Wa(c){for(var a,e,d=[],f=0;f<c[0].length;f++){d[f]={};for(var k=a=0;k<c.length;k++)e=c[k].charAt(f).toUpperCase(),e==da.gapChar?a++:(ka(d,e,f),"Q"!=e&&"E"!=e||ka(d,"QE",f),"E"==e||"D"==e?ka(d,"ED",f):-1<"/[WLVIMAFCYHP]/".indexOf(e)?ka(d,"WLVIMAFCYHP",f):"K"==e||"R"==e?ka(d,"KR",f):("T"==e||"S"==e)&&ka(d,"TS",f));d[f].gapCount=a;e={};for(var l in d[f])e[l+"_nogap"]=(d[f][l]/c.length).toFixed(2),d[f][l]=(d[f][l]/(c.length-a)).toFixed(2);for(l in e)d[f][l]=e[l]}return d}
function oa(c,a){var e=a.find("span").removeClass("hydrophobic polar small proline tiny aliphatic aromatic positive negative charged serThr large");if(0!=e.length){g.each(e,function(z,y){y.style.backgroundColor&&(y.style.backgroundColor="")});a.data("features")||(a.removeData("features"),a.data("currentColourScheme",c));null==c&&(c="rainbow");if(a.data("features")){var d="target-template"==a.data("templateData").type?"chain":"keyseqchain",f={};for(struc_id in a.data("features"))f.$jscomp$loop$prop$ft$18=
a.data("features")[struc_id],a.find("tr["+d+"][struc_id="+struc_id+"]").each(function(z){return function(){var y=g(this).attr(d);$span=g(this).find("span");for(var E=0;E<z.$jscomp$loop$prop$ft$18.length;E++)if(z.$jscomp$loop$prop$ft$18[E].frmChn!=z.$jscomp$loop$prop$ft$18[E].toChn)if(-1<z.$jscomp$loop$prop$ft$18[E].frmChn.indexOf(y)){var S="chain"==d?z.$jscomp$loop$prop$ft$18[E].resStart:z.$jscomp$loop$prop$ft$18[E].upStart;g.each($span.filter("[s="+S+"]"),function(ca,T){T.style.backgroundColor="rgba("+
z.$jscomp$loop$prop$ft$18[E].rgb+",.6)"})}else{if(-1<z.$jscomp$loop$prop$ft$18[E].toChn.indexOf(y)){var pa="chain"==d?z.$jscomp$loop$prop$ft$18[E].resEnd:z.$jscomp$loop$prop$ft$18[E].upEnd;g.each($span.filter("[s="+pa+"]"),function(ca,T){T.style.backgroundColor="rgba("+z.$jscomp$loop$prop$ft$18[E].rgb+",.6)"})}}else-1!=z.$jscomp$loop$prop$ft$18[E].frmChn.indexOf(y)&&(S="chain"==d?z.$jscomp$loop$prop$ft$18[E].resStart:z.$jscomp$loop$prop$ft$18[E].upStart,pa="chain"==d?z.$jscomp$loop$prop$ft$18[E].resEnd:
z.$jscomp$loop$prop$ft$18[E].upEnd,g.each($span.filter("[s]"),function(ca,T){T.getAttribute("s")>=S&&T.getAttribute("s")<=pa&&(T.style.backgroundColor="rgba("+z.$jscomp$loop$prop$ft$18[E].rgb+",.6)")}))}}(f)),f={$jscomp$loop$prop$ft$18:f.$jscomp$loop$prop$ft$18}}else if("chain"==c||"uniqueChain"==c||"template"==c){d=[];var k=null;if("undefined"!=typeof globalTemplateData){k=globalTemplateData;if(!globalTemplateData.chainColoursAssigned){for(var l=0;l<globalTemplateData.length;l++){var m=globalTemplateData[l];
m.chainColours={chain:[],unique:[],template:P[l%P.length]};var n=m.chain_name?"chain_name":"chain";for(f=0;f<m[n].length;f++){m.chainColours.unique[1<m[n][f].length?m[n][f].join(""):m[n][f]]=P[fa];fa++;fa%=12;for(var t=0;t<m[n][f].length;t++)m.chainColours.chain[m[n][f][t]]=P[V],V++,V%=P.length}}globalTemplateData.chainColoursAssigned=!0}d=["struc_id","chain"]}else{k=a.data("templateData");d="model-template"==k.type?["struc_id","keyseqchain"]:["struc_id","chain"];var q="model-template"==k.type;(k=
k.templates)&&!k.chainColoursAssigned&&g(".alignTbl").each(function(){if(g(this).data("templateData")&&g(this).data("templateData").templates){var z=q?g(this).data("templateData").keyseq_chain_name:null,y=g(this).data("templateData").templates;if(!y.chainColoursAssigned){for(var E=0;E<y.length;E++)if(y[E].chainColours={chain:[],unique:[]},z)for(var S=0;S<z.length;S++)y[E].chainColours.chain[z[S]]=P[V],y[E].chainColours.unique[z[S]]=P[fa],V++,V%=P.length;else y[E].chainColours.chain[y[E].chain]=P[V],
y[E].chainColours.unique[y[E].chain]=P[fa],V++,V%=P.length;fa++;fa%=P.length;y.chainColoursAssigned=!0}}})}k?(f=a.find("tr["+d[1]+"]"),g.each(f,function(z,y){var E=y.getAttribute(d[0]),S=y.getAttribute(d[1]);if(!S)return!1;for(var pa=g(this).find("span"),ca=null,T=0;T<k.length;T++)k[T].struc_id==E&&(ca=k[T],pa.each(function(jb,ta){if("-"!=ta.textContent)if("chain"==c)ta.style.backgroundColor=ca.chainColours.chain[S];else if("template"==c)ta.style.backgroundColor=ca.chainColours.template;else for(chns in ca.chainColours.unique)-1<
chns.indexOf(S)&&(ta.style.backgroundColor=ca.chainColours.unique[chns])}))})):a.find("span").each(function(z,y){y.style.backgroundColor=P[g(".alignTbl").index(a)%P.length]})}else if("rainbow"==c){var r=function(z,y){if(null!=y.getAttribute("s")){var E=z/v*(1.5*Math.PI-Math.PI/2)+Math.PI/2;y.style.backgroundColor="rgba("+Math.round(127.5*(Math.sin(E+Math.PI)+1))+","+Math.round(255*Math.sin(E-Math.PI/2))+","+Math.round(127.5*(Math.sin(E)+1))+",.6)"}},v=0,w=!1,u=0,A=a.find("tr");A.each(function(z,y){0==
z&&(w="model-template"==y.getAttribute("keyseqtype"));if(parseInt(y.getAttribute("seqno"))<=u)return!1;u=parseInt(y.getAttribute("seqno"));w&&null==y.getAttribute("keyseqtype")||($span=A.filter("[seqno="+u+"]").find("span"),v=$span.length,$span.each(r))})}else if("soa"==c||-1<c.indexOf("bfactor")||"entropy"==c)Ka(a,c);else if(-1<c.indexOf("consistency")){f=e.filter("[c]");if(0==f.length)return;var D=999999,B=0,C;"consistencyRange"==c?g.each(f,function(z,y){C=parseFloat(y.getAttribute("c"));D=Math.min(D,
C);B=Math.max(B,C)}):(D=0,B=1);var F=127,K=195,M=45;g.each(f,function(z,y){B!=D&&(C=(parseFloat(y.getAttribute("c"))-D)/(B-D),.5>C?(F=Math.round(255*(1-C)),K=Math.round(160*C),M=90*C):(F=127,K=Math.round(20+175*C),M=45));y.style.backgroundColor="rgba("+F+","+K+","+M+",0.6)"})}else if("qmean_local"==c){var I,O,X;g.each(e.filter("[q]"),function(z,y){var E=parseFloat(y.getAttribute("q"));.5>E?y.style.backgroundColor="rgba(255,80,0,.6)":(E=(E-.5)/.4,I=Math.round(255*(1-E)),X=Math.round(255*E),y.style.backgroundColor=
"rgba("+I+",90,"+X+",.6)")})}else if("clustal"==c){var J=a.data("clustalColours");J||(f=Ga(a.data("templateData"),a),J=Wa(f.concat(f.target)),a.data("clustalColours",J));var L,Y=0;a.find("tr").each(function(){if(parseInt(g(this).attr("seqno"))<Y)return!1;Y=parseInt(g(this).attr("seqno"));g.each(a.find("tr[seqno="+Y+"] span"),function(z,y){y.hasAttribute("r")&&((L=y.getAttribute("r"),"P"==L)?y.style.backgroundColor=Xa:"G"==L?y.style.backgroundColor=Ya:"H"!=L&&"Y"!=L||!(.6<=J[z].WLVIMAFCYHP||.5<J[z].P)?
"D"==L&&(.5<=J[z].N||.5<=J[z].ED&&.5<=!J[z].QE)?y.style.backgroundColor=La:"E"==L&&(.5<=J[z].ED||.5<=J[z].QE)?y.style.backgroundColor=La:"C"==L&&.85<=J[z].C?y.style.backgroundColor=$a:"N"==L&&(.5<=J[z].N||.85<=J[z].D)?y.style.backgroundColor=ua:"Q"==L&&(.6<=J[z].KR||.5<=J[z].QE)?y.style.backgroundColor=ua:"S"==L&&(.5<=J[z].TS||.8<=J[z].WLVIMAFCYHP)?y.style.backgroundColor=ua:"T"==L&&(.5<=J[z].TS||.6<=J[z].WLVIMAFCYHP)?y.style.backgroundColor=ua:"R"!=L&&"K"!=L||!(.6<=J[z].KR||.85<=J[z].Q)?-1<"/[WLVIMAF]/".indexOf(L)&&
(.5<=J[z].P||.6<=J[z].WLVIMAFCYHP)?y.style.backgroundColor=Ma:"A"!=L&&"C"!=L||!(.5<=J[z].P||.6<=J[z].WLVIMAFCYHP||.85<=J[z].S)||(y.style.backgroundColor=Ma):y.style.backgroundColor=ab:y.style.backgroundColor=Za)})})}else if("secstruc"==c){m=g.cookie("secStruct");if(null==m||"none"==m)m="dssp";k=a.data("templateData");n=a.find("tr");if(k.keyseq_annotation){var Na=k.templates[0].trg_offset?k.templates[0].trg_offset:1;for(l=0;l<k.keyseq_chain_name.length;l++)if(f=k.keyseq_chain_name[l],k.keyseq_annotation[f]&&
k.keyseq_annotation[f][m]){annot=Oa(k.keyseq_annotation[f],m).replace(/[GI]/g,"H").replace(/B/g,"E");if(!annot)break;$row=n.filter('[keyseqchain="'+f+'"]');t=n.filter('[keyseqchain="'+f+'"]').find("span[s]").toArray();g.each(t,function(z,y){la=parseInt(y.getAttribute("s"));"E"==annot[la-Na]?y.style.backgroundColor="rgba(51,204,51,.6)":"H"==annot[la-Na]&&(y.style.backgroundColor="rgba(153,153,230,.6)")})}}Y=0;for(I=1;I<n.length;I++){f=n.eq(I);if(parseInt(f.attr("seqno"))<Y)break;Y=parseInt(f.attr("seqno"));
if(!f.attr("keyseqtype")){l=f.attr("tpl_id");var Pa=f.attr("chain");$row=l?n.filter('[tpl_id="'+l+'"]'):n.filter('[chain="'+Pa+'"]');t=$row.find("span[s]").toArray();for(f=0;f<k.templates.length;f++)if((l?k.templates[f].id==l:k.templates[f].chain==Pa)&&k.templates[f].annotation&&k.templates[f].annotation[m]){annot=Oa(k.templates[f].annotation,m);annot=annot.replace(/[GI]/g,"H").replace(/B/g,"E");var la=0;g.each(t,function(z,y){la=parseInt(y.getAttribute("s"));"E"==annot[la-1]?y.style.backgroundColor=
"rgba(51,204,51,.6)":"H"==annot[la-1]&&(y.style.backgroundColor="rgba(153,153,230,.6)")})}}}}else if("hydrophobic"==c){var ma;g.each(e,function(z,y){(L=y.getAttribute("r"))&&R[L]&&(ma=R[L].hydropathy,I=Math.round(255*ma),X=255-Math.round(255*ma),y.style.backgroundColor="rgba("+I+",0,"+X+",.6)")})}else if("size"==c)g.each(e,function(z,y){(L=y.getAttribute("r"))&&R[L]&&(ma=R[L].mw,I=Math.round(255*ma),O=255-Math.round(255*ma),y.style.backgroundColor="rgba("+I+","+O+",0,.6)")});else if("charged"==c){var Aa=
R.positive;g.each(e,function(z,y){-1<R.positive.indexOf(y.getAttribute("r"))?y.style.backgroundColor="rgba(100,100,255,.6)":-1<R.negative.indexOf(y.getAttribute("r"))&&(y.style.backgroundColor="rgba(255,100,100,.6)")})}else if("cysteine"==c)Aa=R.positive,g.each(e,function(z,y){"C"==y.getAttribute("r")&&(y.style.backgroundColor="rgba(202,168,14,.6)")});else if("indels"==c){k=a.data("templateData");if("model-template"!=k.type)return;f=a.find("tr[chain]").find("span");for(l=0;l<k.keyseq_chain_name.length;l++){var Z=
a.find('tr[keyseqchain="'+k.keyseq_chain_name[l]+'"]').find("span"),bb=Z.length;Z.each(function(z,y){"-"==y.textContent&&(0<z&&"-"!=Z.get(z-1).textContent&&(Z.get(z-1).style.backgroundColor="rgba(0,0,255,.6)"),z<bb-2&&"-"!=Z.get(z+1).textContent&&(Z.get(z+1).style.backgroundColor="rgba(0,0,255,.6)"))});f.each(function(z,y){"-"==y.textContent&&"-"!=Z.get(z).textContent&&null!=Z.get(z).q&&(Z.get(z).style.backgroundColor="rgba(0,255,0,.6)")})}}else c&&"none"!=c&&(Aa=R[c])&&g.each(e,function(z,y){-1<
Aa.indexOf(y.getAttribute("r"))&&g(y).addClass(c)});g.cookie("targetMismatch")?"fade"==g.cookie("targetMismatch")?e.filter("[nm]").addClass("targetMismatch"):"enhance"==g.cookie("targetMismatch")&&(e.not("[nm]").addClass("targetMismatch"),e.not("[s]").addClass("targetMismatch")):e.filter("[nm]").addClass("targetMismatch");ha&&(N&&a.find("tr[seqno="+N.seqno+"]").find("span").eq(N.seqidx).addClass("cursor"),a.data("startEditRegion")&&a.data("endEditRegion")&&(e=a.data("startEditRegion"),f=a.data("endEditRegion"),
l=e.closest("tr"),Y=l.attr("seqno"),l=l.siblings("[seqno="+Y+"]").addBack().find("span"),m=a.find("tr[seqno="+Y+"]").find("span"),m=m.slice(l.index(e),l.index(f)+1).addClass("shadowCursor"),a.data("startEditRegion",m.first()),a.data("endEditRegion",m.last())))}}function Ka(c,a){if(c.data("templateData")){var e=c.data("templateData").templates;if(e){"undefined"===typeof currentWin&&(currentWin=window);for(var d={},f=0;f<e.length;d={$jscomp$loop$prop$identifier$7$26:d.$jscomp$loop$prop$identifier$7$26,
$jscomp$loop$prop$assigned$25:d.$jscomp$loop$prop$assigned$25},f++)if(d.$jscomp$loop$prop$identifier$7$26=null,-1==a.indexOf("bfactor")&&"undefined"!=typeof SCORE_URL?(d.$jscomp$loop$prop$identifier$7$26=e[f].pdb_id,d.$jscomp$loop$prop$identifier$7$26&&4!=d.$jscomp$loop$prop$identifier$7$26.length||(d.$jscomp$loop$prop$identifier$7$26=e[f].qname.match(/\w{4}\.\d+/)[0])):d.$jscomp$loop$prop$identifier$7$26=e[f].struc_id,d.$jscomp$loop$prop$identifier$7$26 in H||(H[d.$jscomp$loop$prop$identifier$7$26]=
{}),e[f].selected&&!(a in H[d.$jscomp$loop$prop$identifier$7$26]))if(-1<a.indexOf("bfactor")){H[d.$jscomp$loop$prop$identifier$7$26].bfactor={};d.$jscomp$loop$prop$assigned$25=!1;if(0<g("#pv:visible",currentWin.document).length)pv_viewer.forEach(function(t){return function(q){if(q.name()==t.$jscomp$loop$prop$identifier$7$26){for(var r={},v=0;v<q.structure().chains().length;r={$jscomp$loop$prop$cname$9$22:r.$jscomp$loop$prop$cname$9$22},v++){var w=q.structure().chains()[v];r.$jscomp$loop$prop$cname$9$22=
w.name();"_"==r.$jscomp$loop$prop$cname$9$22||"-"==r.$jscomp$loop$prop$cname$9$22||-1<r.$jscomp$loop$prop$cname$9$22.indexOf("_res")||(H[t.$jscomp$loop$prop$identifier$7$26].bfactor[r.$jscomp$loop$prop$cname$9$22]={values:[],colours:[]},w.eachResidue(function(u){return function(A){for(var D=0,B=0;B<A._atoms.length;B++)D+=A._atoms[B].tempFactor();D/=A._atoms.length;H[t.$jscomp$loop$prop$identifier$7$26].bfactor[u.$jscomp$loop$prop$cname$9$22].values[A.num()-1]=D}}(r)))}t.$jscomp$loop$prop$assigned$25=
!0}}}(d));else if(0<g("#ngl:visible",currentWin.document).length){var k=getNGLComponentByName(d.$jscomp$loop$prop$identifier$7$26);k&&k.structure.eachChain(function(t){return function(q){q.chainname.match(/(_|-)/)||(H[t.$jscomp$loop$prop$identifier$7$26].bfactor[q.chainname]={values:[],colours:[]},q.eachResidue(function(r){var v=0;r.eachAtom(function(w){v+=w.bfactor});H[t.$jscomp$loop$prop$identifier$7$26].bfactor[q.chainname].values[r.resno-1]=v/r.atomCount}),t.$jscomp$loop$prop$assigned$25=!0)}}(d))}mn=
1E10;mx=-1E10;count=rms=0;k=!0;for(cname in H[d.$jscomp$loop$prop$identifier$7$26].bfactor)for(var l=H[d.$jscomp$loop$prop$identifier$7$26].bfactor[cname],m=0;m<l.values.length;m++){var n=l.values[m];null!=n&&(1<n&&(k=!1),mn=Math.min(n,mn),rms+=n*n,count++,l.colours[m]=10>=n?"0,0,255":10<n&&15>=n?"115,115,255":15<n&&20>=n?"170,170,255":20<n&&25>=n?"215,215,255":25<n&&30>=n?"255,215,215":30<n&&35>=n?"255,170,170":35<n&&40>=n?"255,115,115":"255,0,0")}if(d.$jscomp$loop$prop$assigned$25&&k)H[d.$jscomp$loop$prop$identifier$7$26].bfactor=
null,H[d.$jscomp$loop$prop$identifier$7$26].bfactor_range=null;else{if("bfactor_range"==a){H[d.$jscomp$loop$prop$identifier$7$26].bfactor_range={};k=[];for(l=0;256>l;l++)k.push(l+","+l+",255");for(l=256;512>l;l++)k.push("255,"+(512-l)+","+(512-l));rms/=count;rms=Math.sqrt(rms);mx=2*rms;for(chn in H[d.$jscomp$loop$prop$identifier$7$26].bfactor)for(H[d.$jscomp$loop$prop$identifier$7$26].bfactor_range[chn]={colours:[],values:[]},l=0;l<H[d.$jscomp$loop$prop$identifier$7$26].bfactor[chn].values.length;l++)(m=
H[d.$jscomp$loop$prop$identifier$7$26].bfactor[chn].values[l])?(H[d.$jscomp$loop$prop$identifier$7$26].bfactor_range[chn].values[l]=m,idx=Math.round(512*(m-mn)/(mx-mn))-1,idx=Math.max(idx,0),idx=Math.min(idx,511),H[d.$jscomp$loop$prop$identifier$7$26].bfactor_range[chn].colours[l]=k[idx]):H[d.$jscomp$loop$prop$identifier$7$26].bfactor_range[chn].colours[l]=k[0]}if(!d.$jscomp$loop$prop$assigned$25){delete H[d.$jscomp$loop$prop$identifier$7$26].bfactor;delete H[d.$jscomp$loop$prop$identifier$7$26].bfactor_range;
return}}}else if("undefined"!=typeof SCORE_URL){H[d.$jscomp$loop$prop$identifier$7$26][a]=null;g.getJSON(SCORE_URL.replace("xxxx.0",d.$jscomp$loop$prop$identifier$7$26)+a,function(t){return function(q,r){r&&(H[t.$jscomp$loop$prop$identifier$7$26][a]=q,g(".alignTbl").each(function(){Ka(g(this),a)}),qa())}}(d));return}c.find("tr[struc_id]").each(function(){var t=g(this).attr("chain");t||(t=g(this).attr("keyseqchain"));if(t){identifier=-1==a.indexOf("bfactor")?g(this).attr("qname").match(/\w+\.\d+/)[0]:
g(this).attr("struc_id");if(null==H[identifier][a])return!0;if(null==H[identifier][a][t])for(var q in H[identifier][a])for(var r=0;r<q.length;r++)q[r]==t&&(H[identifier][a][q[r]]=H[identifier][a][q]);if(H[identifier]&&H[identifier][a]&&H[identifier][a][t]){var v=null;g(this).find("span[s]").each(function(w,u){v=u.getAttribute("s");null!=H[identifier][a][t].values[v-1]&&(u.title=R[g(this).text()].triplet+" : "+v+"; "+a+" : "+H[identifier][a][t].values[v-1].toFixed(2));u.style.backgroundColor="rgba("+
H[identifier][a][t].colours[v-1]+",.6)"})}}})}}}function qa(c){0<g("#pv:visible",currentWin.document).length&&cb();0<g("#ngl:visible",currentWin.document).length&&(c&&c.singleResidue?db(c.singleResidue):eb(c));if(!("function"!==typeof colourUPArcs&&"function"!==typeof colourRama||c&&c.singleResidue)){var a={};g(".alignTbl").each(function(){$alignTbl=g(this);var e=$alignTbl.data("templateData");if(e&&!$alignTbl.data("options").textOnly){var d=-1,f=null;"model-template"==e.type?$rows=$alignTbl.find("tr[keyseqchain]"):
($rows=$alignTbl.find("tr[chain]"),f=$alignTbl.find("tr[seqno=1]").find("span"));for(;;){d++;e=$rows.filter("[seqno="+d+"]");if(1>e.length)if(1<d)break;else continue;var k=e.attr("chain");k||(k=e.attr("keyseqchain"));var l=e.attr("struc_id"),m=[];a[l]||(a[l]={});a[l][k]||(a[l][k]=m,e.find("span").each(function(n,t){var q=g(t).css("background-color");q&&"transparent"!=q&&-1==q.indexOf("(0, 0, 0")&&(q=q.match(/\d+, \d+, \d+/)[0].split(","),m[f?f[n].getAttribute("s"):t.getAttribute("s")]=q)}))}}});"function"===
typeof colourRama&&colourRama(a);"function"===typeof colourUPArcs&&colourUPArcs(a)}}function db(c){for(schemeId in NGL.ColormakerRegistry.userSchemes)-1<schemeId.indexOf("singleres")&&(NGL.ColormakerRegistry.removeScheme(schemeId),ngl_stage.eachRepresentation(function(e){if(e.repr.colorScheme==schemeId)for(schemeId2 in NGL.ColormakerRegistry.userSchemes)if(schemeId2.endsWith(e.name)){e.setColor(schemeId2);break}}));if(c){var a=c.struc_id;getNGLComponentByName(a)&&ngl_stage.eachRepresentation(function(e){if(e.name==
a&&U[a]){var d=U[a],f=NGL.ColormakerRegistry.addScheme(function(k){for(chn in d)" "==chn&&g("#ngl_status").html("NGL cannot colour or select chains named whitespace!");this.atomColor=function(l){return d[l.chainname]?ngl_picked_atom&&l.structure.name==ngl_picked_atom.structure.name&&l.index==ngl_picked_atom.index?16711680:(l=d[l.chainname][l.resno])?l[0]<<16|l[1]<<8|l[2]:16777215:16777215}},"singleres");e.setColor(f)}})}}function eb(c){var a=null,e;U={};g(".alignTbl:not(.ignoreStructure)").each(function(){e=
g(this);var k=e.data("templateData");if(k&&!e.data("options").textOnly){var l=-1;for(a="model-template"==k.type?e.find("tr[keyseqchain]"):e.find("tr[chain]");;){l++;var m=a.filter("[seqno="+l+"]");if(1>m.length)if(1<l)break;else continue;(k=m.attr("chain"))||(k=m.attr("keyseqchain"));var n=m.attr("struc_id");m=m.find("span");var t=null;t=U[n]&&U[n][k]?U[n][k]:[];m.each(function(q,r){var v=g(r).css("background-color");v&&"transparent"!=v&&-1==v.indexOf("(0, 0, 0")&&(v=v.match(/\d+, \d+, \d+/)[0].split(","),
t[r.getAttribute("s")]=v)});U[n]||(U[n]={});U[n][k]=t}}});c=c&&c.strucId?c.strucId:null;for(var d in ngl_stage.compList)if(void 0!==ngl_stage.compList[d].structure){var f=ngl_stage.compList[d].name;if(!c||f==c){for(schemeId in NGL.ColormakerRegistry.userSchemes)-1<schemeId.indexOf(f)&&-1==schemeId.indexOf("membrane")&&NGL.ColormakerRegistry.removeScheme(schemeId);ngl_stage.eachRepresentation(function(k){if((k.name==f||k.name.endsWith(".highlight"))&&U[f]){var l=U[f],m=NGL.ColormakerRegistry.addScheme(function(n){for(chn in l)" "==
chn&&g("#ngl_status").html("NGL cannot colour or select chains named whitespace!");this.atomColor=function(t){return l[t.chainname]?(t=l[t.chainname][t.resno])?t[0]<<16|t[1]<<8|t[2]:16777215:16777215}},f);k.setColor(m)}})}}}function cb(){if(0!=pv_viewer.all().length){var c=null,a,e={};g(".alignTbl:not(.ignoreStructure)").each(function(){a=g(this);var k=a.data("templateData");if(k&&!a.data("options").textOnly){var l=-1;for(c="model-template"==k.type?a.find("tr[keyseqchain]"):a.find("tr[chain]");;){l++;
var m=c.filter("[seqno="+l+"]");if(1>m.length)if(1<l)break;else continue;(k=m.attr("chain"))||(k=m.attr("keyseqchain"));var n=m.attr("struc_id");m=m.find("span");var t=null;t=e[n]&&e[n][k]?e[n][k]:[];m.each(function(q,r){var v=g(r).css("background-color");v&&"transparent"!=v&&-1==v.indexOf("(0, 0, 0")&&(v=v.match(/\d+, \d+, \d+/)[0].split(","),t[r.getAttribute("s")]=v)});e[n]||(e[n]={});e[n][k]=t}}});for(var d in e){var f=e[d];pv_viewer.get(d)&&pv_viewer.get(d).colorBy(new pv.color.ColorOp(function(k,
l,m){k=k.residue();f[k.chain().name()]&&((k=f[k.chain().name()][k.num()])?(l[m]=k[0]/255,l[m+1]=k[1]/255,l[m+2]=k[2]/255):(l[m]=.9,l[m+1]=.9,l[m+2]=.9),l[m+3]=1)}))}d&&pv_viewer.requestRedraw()}}function ia(c){var a=g.cookie("secStruct");null==a&&(a="dssp");var e=c.attr("id")+"_features";g("#"+e).html("");if(0==g("#"+e).length||a&&"none"==a)c.removeClass("ss"),G(c).removeClass("ss");else{c.addClass("ss");G(c).addClass("ss");var d=c.position().top,f=c.find("td").first().width(),k=c.find("span")[0],
l=k.getBoundingClientRect().width;k=k.getBoundingClientRect().height;var m=c.position().left;if(!(1>f)){p=Raphael(e,f,c.height());g("#"+e).css("top",c.position().top);var n=c.data("templateData");if(n){c=c.find("tr:visible");if(n.keyseq_annotation)for(e=0;e<n.keyseq_chain_name.length;e++){var t=n.keyseq_chain_name[e];if(n.keyseq_annotation[t]){var q=n.templates[0].trg_offset?n.templates[0].trg_offset:1;n.keyseq_annotation[t][a]&&Qa(p,Ra(n.keyseq_annotation[t],a,q),c.filter('[keyseqchain="'+t+'"]'),
c.filter('[keyseqchain="'+t+'"]').find("span[s]").toArray(),d,m,f,l,k);n.charts&&function(A,D,B){setTimeout(function(){fb(A,n.keyseq_annotation[D],a,q,B,d,f,l,5E3>n.pageResidueCount)},0)}(p,t,c.filter('[keyseqchain="'+t+'"]'))}}e=0;for(t=1;t<c.length;t++){var r=c.eq(t);if(parseInt(r.attr("seqno"))<e)break;e=parseInt(r.attr("seqno"));if(!r.attr("keyseqtype")){var v=r.attr("tpl_id");r=r.attr("chain");$row=v?c.filter('[tpl_id="'+v+'"]'):c.filter('[chain="'+r+'"]');for(var w=$row.find("span[s]").toArray(),
u=0;u<n.templates.length;u++)(v?n.templates[u].id==v:n.templates[u].chain==r)&&n.templates[u].annotation&&n.templates[u].annotation[a]&&Qa(p,Ra(n.templates[u].annotation,a),$row,w,d,m,f,l,k)}}}}}}function Oa(c,a){var e=c[a];"string"==typeof e&&(c[a+"_string"]=e.replace(/[GI]/g,"H").replace(/B/g,"E"));return c[a+"_string"]}function Ra(c,a,e){e||(e=1);var d=c[a];if("string"==typeof d){c[a+"_string"]=c[a];d=c[a].replace(/[GI]/g,"H").replace(/B/g,"E");for(var f=null,k=0;k<d.length;k++)if("H"==d[k]||"E"==
d[k])res_index=k+e,null==f?f=[[res_index,res_index,d[k]]]:f[f.length-1][1]==res_index-1&&f[f.length-1][2]==d[k]?f[f.length-1][1]=res_index:f.push([res_index,res_index,d[k]]);c[a]=f}return c[a]}function fb(c,a,e,d,f,k,l,m,n){var t=null!=a.qmean;d||(d=1);var q=c.set(),r=c.set(),v=c.set();f.each(function(w,u){span=g(u).find("span").toArray();if(0!=span.length){var A=ea-W,D=g(u).position().top-k+g(span[0]).position().top-W,B=D,C=u.getBoundingClientRect().left,F=span[span.length-1].getBoundingClientRect().right-
C;if(t){c.path("M0,"+B+"L"+l+","+B+"L"+l+","+(B-A)+"L0,"+(B-A)).attr({"stroke-width":.4,stroke:"#888"});for(var K=3;10>K;K++){var M=B-1/.7*A*(K/10-.3);var I=c.path("M0,"+M+"L"+l+","+M);5==K?I.attr({"stroke-width":.7,opacity:.8,stroke:"#888","stroke-dasharray":"-"}):q.push(I)}}I="";var O;for(K=0;K<span.length;K++)if(M=span[K],M.hasAttribute("s")){if(B=parseInt(M.getAttribute("s"))-d,I=a[e+"_string"]&&a[e+"_string"][B]?I+a[e+"_string"][B]:I+"-",x=M.getBoundingClientRect().left-C,B=D,B-=2,t){var X=Math.max(.3,
parseFloat(M.getAttribute("q")));M=B-1/.7*(A-2)*(X-.3);if(n){var J="245,80,0";.5<X&&(w=Math.round(490*(1-X)),b=Math.round(255*X),J=w+",80,"+b);s=c.path("M"+x+","+B+"L"+x+","+M+"L"+(x+m)+","+M+"L"+(x+m)+","+B);s.attr({fill:"rgba("+J+",.6)",stroke:"#333"})}else O+="M"+x+" "+B,O+="L"+x+" "+M,O+="L"+(x+m)+" "+M,O+="L"+(x+m)+" "+B}}else I+="-";txt=c.text(2,D+W/2,I);r.push(txt);txt.node.setAttribute("textLength",F-4+"px");txt.node.firstChild.setAttribute("textLength",F-4+"px");v.push(c.path(O))}});r.attr({"text-anchor":"start",
"font-family":"consolas"});v.attr({stroke:"#555"});q.attr({"stroke-width":.9,stroke:"#888",opacity:.6,"stroke-dasharray":". "})}function Qa(c,a,e,d,f,k,l,m,n){if(null!=a){e.attr("seqno");for(var t=0,q=d.length,r=0;r<a.length;r++)if("E"==a[r][2]||"H"==a[r][2]){var v=null,w=null,u;for(u=a[r][0];u<=a[r][1];u++)if(!(d[t].getAttribute("s")>u)){for(s=t;s<q;s++)if(d[s].getAttribute("s")==u){t=s;v=g(d[s]);break}if(v)break}for(u=a[r][1];u>=a[r][0];u--){for(s=t;s<q;s++)if(d[s].getAttribute("s")==u){t=s;w=g(d[s]);
break}if(w)break}if(null==v||null==w)t=0;else for(thisRow=v.closest("tr"),startRowIdx=e.index(thisRow),endRowIdx=e.index(w.closest("tr")),v=v.position(),startResLeft=v.left-k,spanTop=v.top,endResLeft=w.position().left-k,rightLimit=thisRow.width()-m-m,w=startRowIdx;w<endRowIdx+1;w++)if(w>startRowIdx&&(thisRow=e.eq(w),spanTop=thisRow.find("span").first().position().top),u=thisRow.position().top+spanTop-f,"E"==a[r][2]){v=c;var A=startResLeft-(w-startRowIdx)*l,D=endResLeft+(endRowIdx-w)*l,B=m,C=n,F=rightLimit;
u+=1;C-=2;padding=2;A=Math.max(-B,Math.round(A));D=Math.min(F,Math.round(D+B));s=v.path("M"+A+","+(u-padding)+"L"+(D-6)+","+(1.5+u)+"L"+(D-6)+","+(u-padding)+"L"+(D+padding)+","+(C/2+u)+"L"+(D-6)+","+(C+u+padding)+"L"+(D-6)+","+(C-1.5+u)+"L"+A+","+(C+u+padding)+"L"+A+","+(u-padding));s.attr({"stroke-width":.7,fill:"#DDD","fill-opacity":.3,stroke:"#226","stroke-dasharray":"5 2"})}else v=c,A=startResLeft-(w-startRowIdx)*l,D=endResLeft+(endRowIdx-w)*l,B=m,C=n,F=rightLimit,padding=2,A=Math.max(-B,Math.round(A)),
D=Math.min(F,Math.round(D+B)),h=v.rect(A,u+2-padding,D-A,C-4+2*padding,4),h.attr({"stroke-width":.7,fill:"#DDD","fill-opacity":.3,stroke:"#226"})}}}function Sa(){var c="";"Multi FASTA"==g("#alignmentFormatSelect").val()?g(".alignTbl:visible").each(function(){c+=Ba(g(this).attr("id").substring(8),"FASTA");c+="\n"}):c=Ba(g("#currentAlignmentIndex").val(),g("#alignmentFormatSelect").val());g("#formattedAlignmentTextarea").val(c);g("#formattedAlignmentTextarea").focus();g("#formattedAlignmentTextarea").select()}
function Ba(c,a){a||(a="fasta");var e=g("#alignNameTbl"+c),d=g("#alignTbl"+c),f=[],k=[],l=[],m=0<g("#alignTbl"+c+" :visible").first().length?":visible":"",n=0;e.find("tr[seqno]"+m).each(function(t,q){parseInt(q.getAttribute("seqno"))>n&&n++}).slice(0,n).each(function(t){var q=g(this).attr("seqno");f[t]=g(this).text();l[t]=g(this).attr("title");breakCount=0;d.find('tr[seqno="'+q+'"]').each(function(r){k[t]||(k[t]="");k[t]+=g(this).find("td").first().text();breakCount+=g(this).find(".insert_l,.insert_r").length});
0<breakCount&&(f[t]="MULTIPLE_SEGMENTS_OF_"+f[t]+" - WARNING - CONTAINS NON-SEQUENTIAL SEGMENTS")});return-1<a.search(/fasta/i)?gb(f,k,l):-1<a.search(/clustal/i)?hb(f,k):""}function gb(c,a,e){if(!a||0==a.length)return"No templates selected";for(var d="",f=0;f<c.length;f++){d+=">"+c[f]+(e&&e[f]?" "+e[f]:"")+"\n";for(var k=0;k<a[f].length;k+=72)d+=a[f].substring(k,k+72)+"\n"}return d}function hb(c,a){if(!a||0==a.length)return"No templates selected";for(var e=0,d=0;d<c.length;d++)e=Math.max(e,c[d].length);
e+=2;for(var f="CLUSTAL\n\n",k=0;k<a[0].length;k+=60){for(d=0;d<c.length;d++){f+=c[d];for(var l=c[d].length;l<e;l++)f+=" ";f+=a[d].substring(k,k+60)+"\n"}f+="\n"}return f=f.substring(0,f.length-2)}function ib(c){$alignNameTbl=G(c);var a=c.closest(".alignTblContainer").outerWidth(),e=c.closest(".alignTblContainer").outerHeight();a+=10;var d='<svg xmlns="http://www.w3.org/2000/svg"  width="'+a+'" height="'+e+'"><rect x="0" y="0" fill="white" width="'+a+'" height="'+e+'"/>',f,k=$alignNameTbl.outerWidth()+
10,l=$alignNameTbl.offset().left-10,m=c.find("td:eq(0)");a=m.outerWidth();var n=g("<div>").append(g("#"+c.attr("id")+"_features svg").first().clone()).html().replace(/name="[\d_]+" /g,"").replace(/r="4" /g,"");d+='<defs><clipPath id="cp2"><rect x="0" y="0" width="'+a+'" height="'+e+'"/></clipPath></defs>';d+='<g transform="translate('+k+',0)" clip-path="url(#cp2)">';d+=n.substring(n.indexOf("</defs>")+7,n.indexOf("</svg>"));d+="</g>";e=c.find("tr:visible");e.each(function(r,v){g(this).find("span.ligandContact").each(function(w,
u){f=v.offsetTop+u.offsetTop;t||(t=g(u).outerWidth(),q=g(u).outerHeight());g(u).css("color");d+='<rect style="fill:#CC4444;fill-opacity:0.8;" width="'+t+'" height="'+q+'" x="'+(g(u).offset().left-l)+'" y="'+f+'" />'})});d+='<text text-anchor="end" font-size="'+m.css("font-size")+"\" font-family='"+m.css("font-family")+"'>";e=$alignNameTbl.find("tr:visible");e.each(function(r,v){var w=g(this).find("td").css("padding-top");w=parseInt(w.substring(0,w.length-2));f=v.offsetTop+12+w;d+='<tspan x="'+(k-
2)+'" y="'+f+'">'+v.textContent.replace("QMEAN","")+"</tspan>"});d+="</text>";e=c.find("tr:visible");var t,q;e.offset();e.each(function(r,v){d+='<text text-anchor="middle" font-size="'+m.css("font-size")+"\" font-family='"+m.css("font-family")+"'>";g(this).find("span").each(function(w,u){t||(t=g(u).outerWidth(),q=g(u).outerHeight());if("relative"!=u.style.position){var A=g(u).css("color");A="fill:"+A+";";"bold"==u.style.fontWeight&&(A+="font-weight:bold;");0<A.length&&(A=' style="'+A+'" ');f=v.offsetTop+
u.offsetTop+12;d+='<tspan x="'+(g(u).offset().left-l+t/2)+'" y="'+f+'"'+A+">"+u.textContent+"</tspan>"}});d+="</text>";(td=g(this).find("td")[1])&&(d+='<text text-anchor="start" font-size="'+m.css("font-size")+"\" font-family='"+m.css("font-family")+"'><tspan x=\""+(g(td).offset().left-l+10)+'" y="'+f+'">'+td.textContent+"</tspan></text>")});e.each(function(r,v){g(this).find("span").not(".ligandContact").each(function(w,u){f=v.offsetTop+u.offsetTop;var A=g(u).css("backgroundColor");A&&"transparent"!=
A&&"rgb(255, 255, 255)"!=A&&(d+='<rect x="'+(g(u).offset().left-l)+'" y="'+f+'" width="'+t+'" height="'+q+'" style="fill:'+A+';"/>')})});return d+"</svg>"}var H={},da={gapChar:"-"},Ta=!1,ha=!1,N=null,ea=0,W=0,ra=!1,va=null,V=0,fa=0,P="rgba(136,221,204,.6) rgba(213,178,64,.6) rgba(187,187,221,.6) rgba(255,136,119,.6) rgba(136,187,221,.6) rgba(255,187,102,.6) rgba(187,221,102,.6) rgba(255,204,238,.6) rgba(166,206,227,.6) rgba(187,136,187,.6) rgba(204,238,204,.6) rgba(166,206,227,.6)".split(" "),na=
{init:function(c){Ta||(Ta=!0,g(document).keydown(function(a){if(ha&&1>g(".fancybox-desktop:visible").length)a:if(ra)a.preventDefault();else{var e=g("span.cursor").closest(".alignTbl");if(32==a.keyCode)a.preventDefault(),Da();else if(8==a.keyCode||46==a.keyCode)a.preventDefault(),Ca(8==a.keyCode);else if(27==a.keyCode){e.data("startEditRegion",null);e.data("endEditRegion",null);g(".shadowCursor").removeClass("shadowCursor");break a}else if((a.ctrlKey||a.metaKey)&&90==a.keyCode){a=g("body").data("editHistory");
if(!(null==a||1>a.length)){a=a.pop();wa(e,a,!0,!0);var d=g(".alignTbl").not(e);0<d.length&&(wa(d,a,!0,!1),g(".cursor").removeClass("cursor"),e.find("tr[seqno="+N.seqno+"]").find("span").eq(N.seqidx).addClass("cursor"))}break a}xa(null,a)}else 27==a.keyCode&&(g(".hoverResidue").removeClass("hoverResidue"),g(".selectResidue").removeClass("selectResidue"))}));return this.each(function(){var a=g.extend({},{type:"target-template",chaingroups:[],keyseq_sequence:c.keyseq_sequence,keyseq_chain_name:c.keyseq_chain_name?
c.keyseq_chain_name:["A"],keyseq_annotation:c.keyseq_annotation},c.templateData);c.nowrap&&(a.nowrap=!0);if(c.charts&&c.keyseq_annotation){a.qmLength=0;a.charts=c.charts;for(key in c.keyseq_annotation)break;c.keyseq_annotation[key].qmean&&(a.pageResidueCount=c.pageResidueCount,ea=48);W=12}c.resetColourCycle&&(V=0);c.firstDraw=!0;g(this).data("templateData",a);ba(g(this),null,c);na.toggleIdenticalSeqs.call(this,{chaingroups:a.chaingroups},!1);na.resizeToParent.call(g(this),{redrawAnnotation:!1});ia(g(this));
Q(g(this));va=g(".alignmentOptions input[name=csRadioGroup]:checked").val()})},toggleIdenticalSeqs:function(c,a){return g(this).each(function(){for(var e=g(this),d=G(e),f=0;f<c.chaingroups.length;f++){var k=c.chaingroups[f].filter(function(){return!0});if(!(2>k.length)){var l=k[0],m=d.find('tr[chain="'+l+'"]').first().text(),n=m.substring(0,m.lastIndexOf(".")+1)+"("+k.join("")+")";m=m.substring(0,m.lastIndexOf("."))+"."+l.charAt(0);for(var t="",q=1;q<k.length;q++)t+="[chain="+k[q]+"]",q<k.length-
1&&(t+=",");e.find("tr"+t).toggle();d.find("tr"+t).toggle();"none"==d.find("tr[chain="+k[1]+"]").css("display")?d.find("tr[chain="+l+"]").find("td").html(n):d.find("tr[chain="+l+"]").find("td").html(m)}}("undefined"==typeof a||a)&&ia(e)})},drawAlignment:function(c){return this.each(function(){ba(g(this),c?c.seqs:null,c?c:null);Q(g(this))})},getFormattedAlignment:function(c){return Ba(g(this).attr("id").substring(8),c.format)},exportAlignment:function(c){return this.each(function(){g("#formattedAlignment").show();
g("#alignmentFormatSelect").val(c.format);Sa();g("<a href='#formattedAlignment' title='Copy & Paste Alignment'/>'").fancybox({helpers:{title:{type:"inside"}}}).trigger("click");g("#formattedAlignmentTextarea").focus();g("#formattedAlignmentTextarea").select()})},html2image:function(c){g.fancybox.close();g(".popover").hide();c=g("#currentAlignmentIndex").val();$alTbl=g("#alignTbl"+c);c=ib($alTbl);c=new Blob([c],{type:"image/svg+xml;charset=utf-8"});c=(window.URL||window.webkitURL||window).createObjectURL(c);
var a=new Image,e=document.createElement("canvas"),d=e.getContext("2d");a.onload=function(){e.width=this.naturalWidth;e.height=this.naturalHeight;d.drawImage(this,0,0);e.toBlob(function(f){saveAs(f,"alignment.png")},"image/png")};a.src=c},getSelectedColourScheme:function(){return va},setSelectedColourScheme:function(c){va=c},colourAlignment:function(c){"undefined"===typeof currentWin&&(currentWin=window);if(c.features)$alignTbls=c.alignTbls?c.alignTbls:g(".alignTbl"),$alignTbls.each(function(){var e=
!1;for(struc_id in c.features)if(0<g(this).find("tr[struc_id="+struc_id+"]").length){e=!0;break}e&&(g(this).data("features",c.features),oa("features",g(this)))});else{jQuery.cookie("colourScheme",c.col,{expires:365,path:"/"});c.col||(c.col=va);var a=g(".alignTbl").each(function(){g(this).removeData("features");null!=g(this).data().options&&delete g(this).data().options.default_colour;oa(c.col,g(this))})}qa();return a},changeExportFormat:function(c){return this.each(function(){Sa()})},secondaryStructure:function(c){c&&
jQuery.cookie("secStruct",c.sstype,{expires:365,path:"/"});var a=null;a=c?c.sstype:g.cookie("secStruct");null==a&&(a="dssp");W="none"==a?0:12;c=this.each(function(){g(this).data("templateData")&&(ia(g(this)),"secstruc"==g(this).data("currentColourScheme")&&oa("secstruc",g(this)))});var e=null,d=null;e=null;"undefined"!=typeof globalTemplateData?(g("#alignTbl"),"undefined"!=typeof globalTemplateData&&(d=globalTemplateData)):g(this).data("templateData")&&("model-template"==g(this).data("templateData").type?
e=!0:(d=[],this.each(function(){g(this).data("templateData")&&(d=d.concat(g(this).data("templateData").templates))})));if(0<g("#pv:visible",currentWin.document).length)if(e)this.each(function(){var q=g(this).data("templateData");if(q){var r=q.struc_id;if(pv_viewer.get(r)){var v=pv_viewer.get(r).structure();pv_viewer.rm(r);var w="none"==a;if(!w)for(var u=0;u<q.keyseq_chain_name.length;u++){var A=q.keyseq_chain_name[u],D=q.templates[0].trg_offset;D||(D=1);var B=q.keyseq_annotation[A][a+"_string"];A=
v.select({chain:A});B?A.eachResidue(function(C){C.full().setSS(B[C.num()-D])}):w=!0}w&&v.select("protein").eachResidue(function(C){C.full().setSS("")});pv_viewer.cartoon(r,v,{color:pv.color.uniform("white")})}}});else for(var f=0;f<d.length;f++){if(d[f].selected){var k=d[f].struc_id;e=pv_viewer.get(k).structure();pv_viewer.rm(k);if("none"==a)e.select("protein").eachResidue(function(q){q.full().setSS("")});else if(d[f].targets)for(var l=0;l<d[f].targets.length;l++)for(var m=d[f].targets[l],n=0;n<m.chain.length;n++)(t=
m.annotation[m.chain[n]][a+"_string"])||(t=m.annotation[m.chain[n]][a]),e.select({chain:m.chain[n]}).eachResidue(function(q){q.full().setSS(t[q.num()-1])});else{var t=d[f].annotation[a+"_string"];t||(t=d[f].annotation[a]);e.select({chain:d[f].chain}).eachResidue(function(q){q.full().setSS(t?t[q.num()-1]:"")})}pv_viewer.cartoon(k,e,{color:pv.color.uniform("white")})}}else if(0<g("#ngl:visible",currentWin.document).length)if(e)this.each(function(){var q=g(this).data("templateData");if(q)for(var r=q.struc_id,
v="none"==a,w=0;w<q.keyseq_chain_name.length;w++){var u=q.keyseq_chain_name[w],A=q.templates[0].trg_offset;A||(A=1);var D=q.keyseq_annotation[u][a+"_string"];D||(v=!0);for(comp in ngl_stage.compList)if(ngl_stage.compList[comp].name==r){ngl_stage.compList[comp].structure.eachResidue(function(B){B.chainname==u&&(B.sstruc=v?"":D[B.resno-A].toLowerCase())});break}}});else for(f=0;f<d.length;f++)if(d[f].selected){ngl_stage.eachRepresentation(function(q){if(q.name&&!q.name.match(/(ligands|dna|over)/)){var r=
q.name;for(comp in ngl_stage.compList)ngl_stage.compList[comp].name==r&&ngl_stage.compList[comp].removeRepresentation(q)}});if("none"==a)for(comp in ngl_stage.compList)ngl_stage.compList[comp].name==d[f].struc_id&&ngl_stage.compList[comp].structure.eachResidue(function(q){q.sstruc=""});else if(d[f].targets)for(l=0;l<d[f].targets.length;l++)for(m=d[f].targets[l],n=0;n<m.chain.length;n++)for(comp in(t=m.annotation[m.chain[n]][a+"_string"])||(t=m.annotation[m.chain[n]][a]),ngl_stage.compList){if(ngl_stage.compList[comp].name==
d[f].struc_id){ngl_stage.compList[comp].structure.eachResidue(function(q){q.chainname==m.chain[n]&&(q.sstruc=t[q.resno-1].toLowerCase())});break}}else for(comp in t=d[f].annotation[a+"_string"]?d[f].annotation[a+"_string"]:d[f].annotation[a],ngl_stage.compList)if(ngl_stage.compList[comp].name==d[f].struc_id){ngl_stage.compList[comp].structure.eachResidue(function(q){q.chainname==d[f].chain&&(q.sstruc=t?t[q.resno-1].toLowerCase():"")});break}k=d[f].struc_id;for(comp in ngl_stage.compList)ngl_stage.compList[comp].name==
k&&ngl_stage.compList[comp].addRepresentation("cartoon",{name:k,sele:"not :_ and not nucleic and not :-",smoothSheet:!0,aspectRatio:6,roughness:1})}changeRep(g.cookie("defaultRepr"));qa();return c},targetMismatch:function(c){c.match?jQuery.cookie("targetMismatch",c.match,{expires:365,path:"/"}):jQuery.removeCookie("targetMismatch",{path:"/"});return this.each(function(){g(this).find("span.targetMismatch").removeClass("targetMismatch");if("fade"==c.match)g("#enhanceMismatch_cb").prop("checked",!1),
g(this).find("span[nm]").addClass("targetMismatch");else if("enhance"==c.match){g("#fadeMismatch_cb").prop("checked",!1);var a=g(this).find("span");a.not("[nm]").addClass("targetMismatch");a.not("[s]").addClass("targetMismatch")}})},viewerInitialised:function(c){g.cookie("colourScheme")&&0==g.cookie("colourScheme").indexOf("bfactor")&&"undefined"===typeof defaultColour?g(".alignTbl").alignment("colourAlignment",{col:g.cookie("colourScheme")}):qa(c);0<g("#pv:visible",currentWin.document).length&&pv_viewer.fitParent()},
updateColoursSingleResidue:function(c){qa({singleResidue:c})},resizeToParent:function(c,a){a=c?c.redrawAnnotation:!0;return this.each(function(){var e=g(this);if(e.is(":visible")&&e.data("templateData")){var d=g(this).find("tr:visible td").first(),f=d.find("span").first()[0],k=e.width()-d.width(),l=e.parent().closest("table").parent();l=l.width()-(e.offset().left-l.offset().left)-k;e.data("templateData").nowrap&&(l=1E7);k=d.text().length;f=Math.floor(l/f.getBoundingClientRect().width);e.data("options").textOnly&&
(f=Math.floor(l/(d.width()/d.text().length)));f-=f%5;1>f&&(f=5);d=0<e.find("tr:hidden").length;l=e.data("templateData").chaingroups;f>k&&1<e.find("tr[keyseqchain]").length||f<k?(e.attr("cols_cookie")&&g.cookie(e.attr("cols_cookie"),f,{expires:365,path:"/"}),ba(e,null,{cols:f}),a&&ia(e),d&&na.toggleIdenticalSeqs.call(e,{chaingroups:l})):(a&&ia(e),g("#"+e.attr("id")+"_features").css("top",e.position().top))}})},toggleEditMode:function(c){g(this).attr("id").substring("8");(ha=c&&null!=c.edit?c.edit:
!ha)?(g("a[id^=gapEdit_]").css("opacity",1),g(".hoverResidue").removeClass("hoverResidue"),null==N&&(N={seqno:1,seqidx:0}),g(this).find("tr[seqno="+N.seqno+"]").find("span").eq(N.seqidx).addClass("cursor")):(g("a[id^=gapEdit_]").css("opacity",.6),g(".cursor").removeClass("cursor"))},removeGappedColumns:function(c){c=g(this).data("templateData").templates;var a=c[0].trg_seq;for(var e=c[0].tpl_seq,d="",f="",k=0;k<a.length;k++)if("-"!=a.charAt(k)||"-"!=e.charAt(k))d+=a.charAt(k),f+=e.charAt(k);a=[d,
f];c[0].trg_seq=a[0];c[0].tpl_seq=a[1];ba(g(this))}},Ha={},ab="rgba(238,51,17,.5)",Ma="rgba(17,119,238,.5)",ua="rgba(17,204,17,.5)",Ya="rgba(255,102,0,.5)",Za="rgba(17,187,187,.5)",$a="rgba(238,119,119,.5)",La="rgba(204,68,204,.5)",Xa="rgba(204,204,0,.5)",R={A:{name:"Alanine",triplet:"ALA",hydropathy:.7,mw:.11},C:{name:"Cysteine",triplet:"CYS",hydropathy:.78,mw:.35},D:{name:"Aspartate",triplet:"ASP",hydropathy:.11,mw:.45},E:{name:"Glutamate",triplet:"GLU",hydropathy:.11,mw:.56},F:{name:"Phenylalanine",
triplet:"PHE",hydropathy:.81,mw:.7},G:{name:"Glycine",triplet:"GLY",hydropathy:.46,mw:0},H:{name:"Histidine",triplet:"HIS",hydropathy:.14,mw:.62},I:{name:"Isoleucine",triplet:"ILE",hydropathy:1,mw:.43},K:{name:"Lysine",triplet:"LYS",hydropathy:.07,mw:.55},L:{name:"Leucine",triplet:"LEU",hydropathy:.92,mw:.43},M:{name:"Methionine",triplet:"MET",hydropathy:.71,mw:.57},N:{name:"Asparagine",triplet:"ASN",hydropathy:.11,mw:.44},P:{name:"Proline",triplet:"PRO",hydropathy:.32,mw:.31},Q:{name:"Glutamine",
triplet:"GLN",hydropathy:.11,mw:.55},R:{name:"Arginine",triplet:"ARG",hydropathy:0,mw:.77},S:{name:"Serine",triplet:"SER",hydropathy:.41,mw:.23},T:{name:"Threonine",triplet:"THR",hydropathy:.42,mw:.34},V:{name:"Valine",triplet:"VAL",hydropathy:.97,mw:.32},W:{name:"Tryptophan",triplet:"TRP",hydropathy:.4,mw:1},Y:{name:"Tyrosine",triplet:"TYR",hydropathy:.36,mw:.82},B:{name:"Aspartate or Asparagine",triplet:"ASX"},Z:{name:"Glutamate or Glutamine",triplet:"GLX"},J:{name:"Leucine or Isoleucine",triplet:"XLE"},
X:{name:"Unknown",triplet:"UNC"},"?":{name:"Unknown",triplet:"UNC"},hydrophobic:"LIFWVM",polar:"RKDENQ",small:"TDN",large:"WYRFH",aliphatic:"ILV",charged:"HKRED",positive:"HKR",negative:"ED",tiny:"AGS",aromatic:"FYWH",proline:"P",serThr:"ST"},U=null;g.fn.alignment=function(c){if(na[c])return na[c].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof c&&c)g.error("Method "+c+" does not exist on alignment.min.js");else return na.init.apply(this,arguments)}})(jQuery);
Object.keys||(Object.keys=function(g){var G=[],Q;for(Q in g)g.hasOwnProperty(Q)&&G.push(Q);return G});$(document).on("click",".alignmentOptions input[name=csRadioGroup]",function(){var g=$(this).val();$(".alignTbl").alignment("colourAlignment",{col:g});$(".alignTbl").alignment("setSelectedColourScheme",g)});$(document).on("click","#viewerSelect input[name=3dRG]",function(){showViewer($(this).val())});
$("body").on("highlightResidue",function(g,G){if("alignment"!=G.src){G.multiple||$(".hoverResidue").removeClass("hoverResidue");var Q=$('.alignTbl tr[struc_id^="'+G.struc_id+'"]:visible');0==Q.length&&(Q=$('.alignTbl tr[tpl_id="'+G.struc_id+'"]:visible'));if(0<Q.length){var aa=Q.filter('[chain="'+G.chain+'"]');0==aa.length&&(aa=Q.filter('[keyseqchain="'+G.chain+'"]'));0<aa.length&&aa.find("span[s="+G.resno+"]").addClass("hoverResidue")}}});
$("body").on("click",function(g){$("a[id^=options_]").each(function(){$(this).is(g.target)||0!==$(this).has(g.target).length||0!==$(".popover").has(g.target).length||((($(this).popover("hide").data("bs.popover")||{}).inState||{}).click=!1)})});
$("a[id^=options_]").css("visibility","visible").each(function(){$(this).popover({html:!0,placement:"auto",content:$("#alignmentOptions"),container:1==$(this).closest("#viewerWrapper").length?"#right-panel":"body"})}).on("show.bs.popover",function(g){var G=$(this).attr("id").substring(8);$(this).data("bs.popover").$tip.find("#exportOptions");$("#currentAlignmentIndex").val(G);1==$("#exportOptions").length?($("#alignmentOptions").show(),""==G?$("#exportOptions").hide():$("#exportOptions").show()):
$("a[id^=options_]").each(function(){$(this).data("bs.popover")&&$(this).data("bs.popover").$tip&&1==$(this).data("bs.popover").$tip.find("#exportOptions").length&&(""==G?$(this).data("bs.popover").$tip.find("#exportOptions").hide():$(this).data("bs.popover").$tip.find("#exportOptions").show())})});
0<$("#bgColSlider").length&&$("#bgColSlider").slider({value:$.cookie("bg_r")?$.cookie("bg_r"):255,min:0,max:255,step:1,slide:function(g,G){pv_viewer.options("background",[G.value/255,G.value/255,G.value/255]);ngl_stage&&ngl_stage.setParameters({backgroundColor:"rgb("+G.value+","+G.value+","+G.value+")"});jQuery.cookie("bg_r",G.value,{expires:365,path:"/"})},change:function(g,G){pv_viewer.options("background",[G.value/255,G.value/255,G.value/255]);ngl_stage&&ngl_stage.setParameters({backgroundColor:"rgb("+
G.value+","+G.value+","+G.value+")"});jQuery.cookie("bg_r",G.value,{expires:365,path:"/"});180>G.value?$("#ngl_status, #pv_status").addClass("status_dark"):$("#ngl_status, #pv_status").removeClass("status_dark")}});$.cookie("bg_r")&&180>$.cookie("bg_r")&&$("#ngl_status, #pv_status").addClass("status_dark");